import{i as A,g as b,C as U}from"./touchCoordinates-Bw5yO7gY.js";import{a as L,s as w,m as D,g as G,b as W,c as Z,_ as k,R as q}from"./getRenderLoop-C12lOm9E.js";import{d as Y,o as J,c as j,a as P,w as F,n as v,b as H,_ as K}from"./index-C_69i0rk.js";const Q=(e,t)=>[e[0]+t[0],e[1]+t[1],e[2]+t[2]],X=(e,t)=>[e[0]-t[0],e[1]-t[1],e[2]-t[2]],R=([e,t,i],o)=>[e*o,t*o,i*o],ee=e=>[Math.round(e[0]),Math.round(e[1]),Math.round(e[2])],te=[[248,249,250],[25,135,84]],oe=e=>`rgb(${e[0]}, ${e[1]}, ${e[2]})`,ne=(e,t)=>{const i=X(e[1],e[0]),o=R(i,1/t),n=[];for(let r=0;r<t-1;r+=1)n.push(Q(e[0],ee(R(o,r))));return n.push(e[1]),n.map(r=>oe(r))},se=([e,t])=>[e**2-t**2,2*e*t],N=100,V=(e,t)=>{let i=[...e];for(let o=0;o<N;o+=1){const n=L(se(i),t);if(n[0]**2+n[1]**2>4)return{value:!1,stepsCount:o};i=n}return{value:!0}},re=({coordinatesCenter:e,pixelsPerOneMathCoordinate:t,canvas:i})=>{const o={coordinatesCenter:e,pixelsPerOneMathCoordinate:t},n=[i.width,i.height],r=[i.width/2,i.height/2],d=s=>[s[0]-o.coordinatesCenter[0],n[1]-s[1]-(n[1]-o.coordinatesCenter[1])],c=s=>[s[0]+o.coordinatesCenter[0],n[1]-s[1]-(n[1]-o.coordinatesCenter[1])],l=s=>{const a=d(s);return D(a,1/o.pixelsPerOneMathCoordinate)},h=s=>{const a=D(s,o.pixelsPerOneMathCoordinate),C=c(a);return[Math.round(C[0]),Math.round(C[1])]};return{toMathCoordinates:l,toCanvasCoordinates:h,getBoundingCanvasCoordinates:s=>{const a=h(s);return a[0]<0&&(a[0]=0),a[0]>n[0]&&(a[0]=n[0]),a[1]<0&&(a[1]=0),a[1]>n[1]&&(a[1]=n[1]),a},setCoordinatesCenter:s=>{o.coordinatesCenter=s},setPixelsPerOneMathCoordinate:s=>{o.pixelsPerOneMathCoordinate=s},getCoordinatesCenter:()=>o.coordinatesCenter,getPixelsPerOneMathCoordinate:()=>o.pixelsPerOneMathCoordinate,setCenterToMathCoordinates:s=>{const a=h(s),C=w(a,o.coordinatesCenter);o.coordinatesCenter=w(r,C)}}},ae=({start:e,end:t,step:i=16,callback:o,isLowQuality:n=!1})=>{let r=i,d=!1;const c=G(()=>{for(let l=e[0],h=0;l<t[0];l+=r,h+=1){const M=h%2===0,g=M&&d?r*2:r,_=M&&d?e[1]+r:e[1];for(let f=_;f<t[1];f+=g)o([l,f],r)}(r<=1||n)&&c.stop(),r/=2,d=!0});c.run()},$=ne(te,N),y=$[0],ie=[.14,.6],ce=e=>V(e,ie),B=e=>V([0,0],e),de=20,le=4,Ce=({canvas:e})=>{const t=e.getContext("2d");W(t);const o=(Math.min(e.width,e.height)-de*2)/le,n=[e.width/2,e.height/2],r=n;let d=B;const c=re({coordinatesCenter:r,pixelsPerOneMathCoordinate:o,canvas:e}),l=({isLowQuality:u=!1}={})=>{const m=[c.getBoundingCanvasCoordinates([-2,2]),c.getBoundingCanvasCoordinates([2,-2])];t.fillStyle=y,t.fillRect(0,0,e.width,e.height),ae({start:m[0],end:m[1],isLowQuality:u,callback:([S,O],T)=>{const z=c.toMathCoordinates([S,O]),E=d(z);t.fillStyle=E.value?"#000":$[E.stepsCount],t.fillRect(S,O,T,T)}})},h=u=>{d=u==="mandelbrot"?B:ce,c.setPixelsPerOneMathCoordinate(o),c.setCoordinatesCenter(r),l()},M=u=>{const m=c.toMathCoordinates(n);c.setPixelsPerOneMathCoordinate(c.getPixelsPerOneMathCoordinate()*u),c.setCenterToMathCoordinates(m),l()};let g=!1,_,f=!1,x,p;const s=u=>{g=!0,_=b(u)},a=u=>{if(!g)return;const[m,S]=b(u);p=w([m,S],_),!Z(p,[0,0])&&(f=!0,x=x??t.getImageData(0,0,e.width,e.height),t.fillStyle=y,t.fillRect(0,0,e.width,e.height),t.putImageData(x,...p))},C=()=>{g&&(g=!1,f&&(c.setCoordinatesCenter(L(c.getCoordinatesCenter(),p)),p=void 0,x=void 0,f=!1,l()))};A()?(e.addEventListener("touchstart",s),e.addEventListener("touchmove",a),window.addEventListener("touchend",C)):(e.addEventListener("mousedown",s),e.addEventListener("mousemove",a),window.addEventListener("mouseup",C));const I=()=>{window.removeEventListener("mouseup",C),window.removeEventListener("touchend",C)};return l(),{selectSet:h,setZoom:M,cleanup:I}},ue=Y({__name:"fractal-sets",setup(e){let t;const i=[[{text:"Mandelbrot set",action:()=>t.selectSet("mandelbrot")},{text:"Julia set",action:()=>t.selectSet("julia")}],[{text:"+",action:()=>t.setZoom(2)},{text:"-",action:()=>t.setZoom(.5)}]],o=n=>{t=Ce({canvas:n})};return J(()=>{t.cleanup()}),(n,r)=>(H(),j("div",{class:v(n.$style.root)},[P(k,{class:v(n.$style.canvasWrapper)},{default:F(({size:d})=>[P(q,{class:v(n.$style.canvas),size:d,onMounted:o},null,8,["class","size"])]),_:1},8,["class"]),P(U,{buttons:i,class:v(n.$style.controls)},null,8,["class"])],2))}}),he="_root_xx87u_1",fe="_canvasWrapper_xx87u_6",ge="_canvas_xx87u_6",pe="_controls_xx87u_15",me={root:he,canvasWrapper:fe,canvas:ge,controls:pe},Me={$style:me},ve=K(ue,[["__cssModules",Me]]);export{ve as default};
